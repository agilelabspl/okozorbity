<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oko z Orbity â€” KtÃ³ry satelita CiÄ™ teraz obserwuje?</title>
<meta name="description" content="SprawdÅº w czasie rzeczywistym, ktÃ³re satelity przelatujÄ… nad TwojÄ… gÅ‚owÄ…. Mapa orbitalnych szpiegÃ³w z kosmosu â€” ISS, Sentinel, Landsat i inne.">
<link rel="canonical" href="https://agilelabspl.github.io/okozorbity/">
<meta name="robots" content="index, follow">
<meta name="author" content="PaweÅ‚ LewiÅ„ski">
<meta name="theme-color" content="#0a0e1a">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:title" content="Oko z Orbity â€” KtÃ³ry satelita CiÄ™ teraz obserwuje?">
<meta property="og:description" content="SprawdÅº w czasie rzeczywistym, ktÃ³re satelity przelatujÄ… nad TwojÄ… gÅ‚owÄ…. Mapa orbitalnych szpiegÃ³w z kosmosu.">
<meta property="og:url" content="https://agilelabspl.github.io/okozorbity/">
<meta property="og:locale" content="pl_PL">
<meta property="og:site_name" content="Oko z Orbity">
<meta property="og:locale:alternate" content="en_US">
<meta property="og:image" content="https://agilelabspl.github.io/okozorbity/og-image.png">
<meta property="og:image:width" content="1600">
<meta property="og:image:height" content="1066">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Oko z Orbity â€” KtÃ³ry satelita CiÄ™ teraz obserwuje?">
<meta name="twitter:description" content="SprawdÅº w czasie rzeczywistym, ktÃ³re satelity przelatujÄ… nad TwojÄ… gÅ‚owÄ…. Mapa orbitalnych szpiegÃ³w z kosmosu.">
<meta name="twitter:image" content="https://agilelabspl.github.io/okozorbity/og-image.png">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-C9XL9PLG0H"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-C9XL9PLG0H');</script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap');

:root {
  --bg: #0a0e1a;
  --card: #111827;
  --accent: #38bdf8;
  --warn: #f97316;
  --alert: #ef4444;
  --green: #22c55e;
  --text: #e2e8f0;
  --muted: #64748b;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Outfit', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* Stars background */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.8), transparent),
    radial-gradient(1px 1px at 30% 60%, rgba(255,255,255,0.5), transparent),
    radial-gradient(1px 1px at 50% 10%, rgba(255,255,255,0.6), transparent),
    radial-gradient(1px 1px at 70% 80%, rgba(255,255,255,0.4), transparent),
    radial-gradient(1px 1px at 90% 40%, rgba(255,255,255,0.7), transparent),
    radial-gradient(1px 1px at 15% 85%, rgba(255,255,255,0.3), transparent),
    radial-gradient(1px 1px at 85% 15%, rgba(255,255,255,0.5), transparent),
    radial-gradient(1.5px 1.5px at 25% 45%, rgba(56,189,248,0.6), transparent),
    radial-gradient(1.5px 1.5px at 75% 55%, rgba(56,189,248,0.4), transparent);
  pointer-events: none;
  z-index: 0;
}

header {
  text-align: center;
  padding: 24px 16px 12px;
  position: relative;
  z-index: 1;
}

h1 {
  font-weight: 900;
  font-size: 1.8rem;
  letter-spacing: -0.5px;
  background: linear-gradient(135deg, var(--accent), #818cf8, var(--accent));
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: shimmer 4s ease-in-out infinite;
}

@keyframes shimmer {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

.subtitle {
  font-weight: 300;
  font-size: 0.9rem;
  color: var(--muted);
  margin-top: 4px;
}

/* Alert bar */
#alert-bar {
  background: linear-gradient(135deg, #16a34a, #22c55e, #16a34a);
  background-size: 200% 200%;
  animation: shimmer-alert 3s ease-in-out infinite;
  color: #fff;
  text-align: center;
  padding: 24px 20px;
  font-weight: 900;
  font-size: 1.4rem;
  letter-spacing: 2px;
  position: relative;
  z-index: 10;
  border-bottom: 2px solid rgba(255,255,255,0.15);
  text-shadow: 0 2px 8px rgba(0,0,0,0.3);
  transition: background 0.5s;
}

#alert-bar.danger {
  background: linear-gradient(135deg, #dc2626, #ef4444, #dc2626);
  background-size: 200% 200%;
  animation: pulse-bg 2s ease-in-out infinite, shimmer-alert 3s ease-in-out infinite;
}

#alert-bar .alert-sub {
  font-size: 0.8rem;
  font-weight: 500;
  letter-spacing: 1px;
  opacity: 0.85;
  margin-top: 4px;
}

@keyframes pulse-bg {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

@keyframes shimmer-alert {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

/* Map */
#map {
  width: 100%;
  height: 45vh;
  min-height: 300px;
  position: relative;
  z-index: 1;
  border-top: 1px solid rgba(56,189,248,0.15);
  border-bottom: 1px solid rgba(56,189,248,0.15);
}

/* Countdown */
.countdown-section {
  padding: 20px 16px;
  text-align: center;
  position: relative;
  z-index: 1;
}

.countdown-label {
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 2px;
}

.countdown-sat {
  font-weight: 700;
  color: var(--accent);
  font-size: 1.1rem;
  margin: 6px 0 2px;
}

.countdown-time {
  font-family: 'JetBrains Mono', monospace;
  font-size: 2.6rem;
  font-weight: 700;
  color: #fff;
  letter-spacing: 2px;
}

.countdown-dist {
  font-size: 0.8rem;
  color: var(--muted);
  margin-top: 2px;
}

/* Passes list */
.passes-section {
  padding: 0 16px 24px;
  max-width: 600px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

.passes-title {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 10px;
}

.pass-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  background: var(--card);
  border-radius: 10px;
  margin-bottom: 6px;
  border: 1px solid rgba(255,255,255,0.04);
}

.pass-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}

.pass-name {
  font-weight: 700;
  font-size: 0.85rem;
  flex: 1;
}

.pass-time {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem;
  color: var(--accent);
}

.pass-dist {
  font-size: 0.7rem;
  color: var(--muted);
  min-width: 60px;
  text-align: right;
}

/* Status bar */
.status-bar {
  text-align: center;
  padding: 8px;
  font-size: 0.7rem;
  color: var(--muted);
  position: relative;
  z-index: 1;
}

.status-bar .dot {
  display: inline-block;
  width: 6px; height: 6px;
  background: var(--green);
  border-radius: 50%;
  margin-right: 4px;
  animation: blink 2s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* Loading */
#loading {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 100;
  transition: opacity 0.5s;
}

#loading.hidden { opacity: 0; pointer-events: none; }

.loader {
  width: 40px; height: 40px;
  border: 3px solid rgba(56,189,248,0.2);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

#loading p {
  margin-top: 16px;
  font-size: 0.85rem;
  color: var(--muted);
}

/* Leaflet overrides */
.leaflet-control-attribution { display: none !important; }

.leaflet-popup-content-wrapper {
  background: var(--card);
  color: var(--text);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 8px 30px rgba(0,0,0,0.5);
}
.leaflet-popup-tip { background: var(--card); }
.leaflet-popup-close-button { color: var(--muted) !important; font-size: 18px !important; }

.sat-popup { font-family: 'Outfit', sans-serif; min-width: 200px; }
.sat-popup-name { font-weight: 900; font-size: 1.05rem; margin-bottom: 6px; }
.sat-popup-desc { font-size: 0.8rem; color: var(--muted); margin-bottom: 8px; }
.sat-popup-row { display: flex; justify-content: space-between; font-size: 0.78rem; padding: 3px 0; border-top: 1px solid rgba(255,255,255,0.05); }
.sat-popup-row span:first-child { color: var(--muted); }
.sat-popup-row span:last-child { font-weight: 600; font-family: 'JetBrains Mono', monospace; font-size: 0.73rem; }

.sat-icon {
  background: none;
  border: none;
}

.sat-marker {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sat-marker .ring {
  position: absolute;
  width: 28px; height: 28px;
  border-radius: 4px;
  border: 2px solid var(--accent);
  opacity: 0.4;
  animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
}

.sat-marker .core {
  width: 12px; height: 12px;
  background: var(--accent);
  border-radius: 2px;
  box-shadow: 0 0 12px var(--accent);
  position: relative;
  z-index: 1;
}

@keyframes ping {
  75%, 100% { transform: scale(2.5); opacity: 0; }
}

.user-marker .core {
  background: var(--green);
  box-shadow: 0 0 12px var(--green);
  border-radius: 50%;
}
.user-marker .ring {
  border-color: var(--green);
  border-radius: 50%;
}

.ufo-icon {
  font-size: 28px;
  filter: drop-shadow(0 0 8px rgba(168,85,247,0.8));
  animation: ufo-wobble 1.5s ease-in-out infinite;
  cursor: pointer;
}

@keyframes ufo-wobble {
  0%, 100% { transform: rotate(-5deg) translateY(0); }
  50% { transform: rotate(5deg) translateY(-3px); }
}

.sat-label {
  position: absolute;
  top: -20px;
  left: 50%;
  transform: translateX(-50%);
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  font-weight: 700;
  color: #fff;
  background: rgba(0,0,0,0.7);
  padding: 1px 5px;
  border-radius: 3px;
  white-space: nowrap;
}

@media (max-width: 480px) {
  h1 { font-size: 1.4rem; }
  .countdown-time { font-size: 2rem; }
  #map { height: 40vh; min-height: 250px; }
}
</style>
</head>
<body>

<div id="loading">
  <div class="loader"></div>
  <p>Szukam satelitÃ³w...</p>
</div>

<header>
  <h1>KtÃ³ry satelita CiÄ™ obserwuje?</h1>
  <div class="subtitle"></div>
</header>

<div id="map"></div>

<div id="alert-bar">Szukam satelitÃ³w nad TobÄ…...</div>

<div class="countdown-section">
  <div class="countdown-label">NajbliÅ¼szy przelot</div>
  <div class="countdown-sat" id="next-sat">â€”</div>
  <div class="countdown-time" id="next-time">--:--:--</div>
  <div class="countdown-dist" id="next-dist"></div>
</div>

<div class="passes-section">
  <div class="passes-title">NadchodzÄ…ce przeloty (24h)</div>
  <div id="passes-list"></div>
</div>

<div class="status-bar">
  <span class="dot"></span>
  <span id="status-text">Aktualizacja co sekundÄ™ Â· Dane orbit: CelesTrak</span>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/satellite.js@5.0.0/dist/satellite.min.js"></script>
<script>
// â”€â”€ I18N â”€â”€
const isPl = navigator.language.startsWith('pl');
document.documentElement.lang = isPl ? 'pl' : 'en';
const T = {
  loading: isPl ? 'Szukam satelitÃ³w...' : 'Searching for satellites...',
  title: isPl ? 'KtÃ³ry satelita CiÄ™ obserwuje?' : 'Which satellite is watching you?',
  pageTitle: isPl ? 'Oko z Orbity â€” KtÃ³ry satelita CiÄ™ teraz obserwuje?' : 'Eye from Orbit â€” Which satellite is watching you right now?',
  alertSearching: isPl ? 'Szukam satelitÃ³w nad TobÄ…...' : 'Searching for satellites above you...',
  nextPassLabel: isPl ? 'NajbliÅ¼szy przelot' : 'Next pass',
  upcomingPasses: isPl ? 'NadchodzÄ…ce przeloty (24h)' : 'Upcoming passes (24h)',
  watchingNow: isPl ? 'OBSERWUJE CIÄ˜ TERAZ!' : 'IS WATCHING YOU NOW!',
  distance: isPl ? 'odlegÅ‚oÅ›Ä‡' : 'distance',
  noOneWatching: isPl ? 'Nikt CiÄ™ teraz nie obserwuje z kosmosu.' : 'Nobody is watching you from space right now.',
  unlessAliens: isPl ? 'No chyba, Å¼e kosmici.' : 'Unless... aliens.',
  calculating: isPl ? 'Obliczam...' : 'Calculating...',
  calculatingPasses: isPl ? 'Obliczam przeloty...' : 'Calculating passes...',
  you: isPl ? 'TY' : 'YOU',
  operator: 'Operator',
  mission: isPl ? 'Misja' : 'Mission',
  launched: isPl ? 'Start' : 'Launched',
  swathWidth: isPl ? 'SzerokoÅ›Ä‡ pasa' : 'Swath width',
  altitude: isPl ? 'WysokoÅ›Ä‡' : 'Altitude',
  distFromYou: isPl ? 'OdlegÅ‚oÅ›Ä‡ od Ciebie' : 'Distance from you',
  sats: isPl ? 'satelitÃ³w' : 'satellites',
  updateEvery: isPl ? 'Aktualizacja co sekundÄ™' : 'Updated every second',
  source: isPl ? 'Å¹rÃ³dÅ‚o' : 'Source',
  ufoOriginLabel: isPl ? 'Pochodzenie' : 'Origin',
  ufoOriginVal: isPl ? 'Poza UkÅ‚adem SÅ‚onecznym' : 'Beyond the Solar System',
  ufoSpeed: isPl ? 'PrÄ™dkoÅ›Ä‡' : 'Speed',
  ufoSpeedVal: isPl ? 'Tak' : 'Yes',
  ufoUnknown: isPl ? 'Nieznany' : 'Unknown',
};

const UFO_MSGS = isPl
  ? ['To nie satelita... To oni.','Nie machaj. Oni juÅ¼ CiÄ™ widzÄ….','LecÄ… po Ciebie. Å»artujemy. A moÅ¼e nie.','Niezidentyfikowany obiekt. Zachowaj spokÃ³j.','UFO potwierdzone. Folia nie pomoÅ¼e.','Kosmici oceniajÄ… TwojÄ… lokalizacjÄ™ na 3/10.','WÅ‚aÅ›nie zrobili Ci zdjÄ™cie. Bez filtra.']
  : ['That\'s no satellite... It\'s them.','Don\'t wave. They already see you.','They\'re coming for you. Just kidding. Or not.','Unidentified object. Stay calm.','UFO confirmed. Tinfoil won\'t help.','Aliens rate your location 3/10.','They just took your photo. No filter.'];

// â”€â”€ SATELLITES (single source of truth â€” dodaj nowego satelitÄ™ = 1 wpis) â”€â”€
// desc/mission: [PL, EN]
// TLE data: 2026-02-16, valid ~2-4 weeks. Live fetch from CelesTrak updates if available.
const SATELLITES = [
  { name: 'ISS (ZARYA)', label: 'ISS', color: '#facc15', swath: 600, operator: 'NASA / ESA / Roskosmos', launched: 1998,
    desc: ['MiÄ™dzynarodowa Stacja Kosmiczna', 'International Space Station'],
    mission: ['ZaÅ‚ogowa stacja badawcza', 'Crewed research station'],
    tle1: '1 25544U 98067A   26047.40850648  .00009877  00000+0  18925-3 0  9992',
    tle2: '2 25544  51.6319 177.5497 0011021 104.3585 255.8628 15.48642691553036' },
  { name: 'SENTINEL-1C', label: 'S1C', color: '#f97316', swath: 250, operator: 'ESA (Copernicus)', launched: 2024,
    desc: ['Radar SAR', 'SAR Radar'],
    mission: ['Obserwacja terenu przez chmury, powodzie, deforestacja', 'Terrain monitoring through clouds, floods, deforestation'],
    tle1: '1 62261U 24235A   26047.50969323  .00000033  00000+0  16680-4 0  9999',
    tle2: '2 62261  98.1821  56.5394 0001314  90.7867 269.3484 14.59199500 63813' },
  { name: 'SENTINEL-2A', label: 'S2A', color: '#38bdf8', swath: 290, operator: 'ESA (Copernicus)', launched: 2015,
    desc: ['Kamera wielospektralna 10m', 'Multispectral camera 10m'],
    mission: ['ZdjÄ™cia optyczne Ziemi, rolnictwo, lasy', 'Optical Earth imagery, agriculture, forests'],
    tle1: '1 40697U 15028A   26047.50847870  .00000236  00000+0  10658-3 0  9993',
    tle2: '2 40697  98.5703 124.1208 0001096  95.8159 264.3149 14.30811844556471' },
  { name: 'SENTINEL-2B', label: 'S2B', color: '#7dd3fc', swath: 290, operator: 'ESA (Copernicus)', launched: 2017,
    desc: ['Kamera wielospektralna 10m', 'Multispectral camera 10m'],
    mission: ['ZdjÄ™cia optyczne Ziemi, rolnictwo, lasy', 'Optical Earth imagery, agriculture, forests'],
    tle1: '1 42063U 17013A   26047.50815789  .00000295  00000+0  12902-3 0  9991',
    tle2: '2 42063  98.5704 124.0056 0001105  88.8176 271.3134 14.30812077467385' },
  { name: 'SENTINEL-2C', label: 'S2C', color: '#0ea5e9', swath: 290, operator: 'ESA (Copernicus)', launched: 2024,
    desc: ['Kamera wielospektralna 10m', 'Multispectral camera 10m'],
    mission: ['ZdjÄ™cia optyczne Ziemi, rolnictwo, lasy', 'Optical Earth imagery, agriculture, forests'],
    tle1: '1 60989U 24157A   26047.19354934  .00000155  00000+0  75657-4 0  9992',
    tle2: '2 60989  98.5660 123.7185 0000941  85.2564 274.8727 14.30816972 75683' },
  { name: 'SENTINEL-3A', label: 'S3A', color: '#a78bfa', swath: 1270, operator: 'ESA (Copernicus)', launched: 2016,
    desc: ['Monitoring oceanÃ³w i temperatury', 'Ocean & temperature monitoring'],
    mission: ['Temperatura morza, chlorofil, poÅ¼ary', 'Sea temperature, chlorophyll, fires'],
    tle1: '1 41335U 16011A   26047.45286537  .00000138  00000+0  75211-4 0  9995',
    tle2: '2 41335  98.6274 116.5444 0001191 103.7487 256.3826 14.26734098520846' },
  { name: 'SENTINEL-3B', label: 'S3B', color: '#c4b5fd', swath: 1270, operator: 'ESA (Copernicus)', launched: 2018,
    desc: ['Monitoring oceanÃ³w i temperatury', 'Ocean & temperature monitoring'],
    mission: ['Temperatura morza, chlorofil, poÅ¼ary', 'Sea temperature, chlorophyll, fires'],
    tle1: '1 43437U 18039A   26047.21562971  .00000135  00000+0  73748-4 0  9995',
    tle2: '2 43437  98.6276 116.4572 0000616  99.9574 260.1676 14.26734438406878' },
  { name: 'SENTINEL-5P', label: 'S5P', color: '#22c55e', swath: 2600, operator: 'ESA (Copernicus)', launched: 2017,
    desc: ['Monitoring jakoÅ›ci powietrza', 'Air quality monitoring'],
    mission: ['NOâ‚‚, metan, ozon, smog', 'NOâ‚‚, methane, ozone, smog'],
    tle1: '1 42969U 17064A   26047.45920159  .00000071  00000+0  54776-4 0  9992',
    tle2: '2 42969  98.7857 350.4862 0001191  79.0209 281.1100 14.19543650432430' },
  { name: 'SENTINEL-6A', label: 'S6A', color: '#6366f1', swath: 300, operator: 'ESA (Copernicus)', launched: 2020,
    desc: ['Altimetria morska', 'Sea level altimetry'],
    mission: ['Poziom morza, fale, wiatr', 'Sea level, waves, wind'],
    tle1: '1 46984U 20086A   26047.38011192 -.00000065  00000+0 -16885-4 0  9995',
    tle2: '2 46984  66.0424  25.9693 0007852 270.9850  89.0265 12.80929476244853' },
  { name: 'LANDSAT 8', label: 'L8', color: '#ef4444', swath: 185, operator: 'NASA / USGS', launched: 2013,
    desc: ['Kamera wielospektralna 30m', 'Multispectral camera 30m'],
    mission: ['NajdÅ‚uÅ¼szy ciÄ…gÅ‚y monitoring Ziemi (od 1972)', 'Longest continuous Earth monitoring (since 1972)'],
    tle1: '1 39084U 13008A   26047.44161355  .00000426  00000+0  10450-3 0  9998',
    tle2: '2 39084  98.1962 119.5108 0001331  90.3314 269.8037 14.57110377680313' },
  { name: 'LANDSAT 9', label: 'L9', color: '#dc2626', swath: 185, operator: 'NASA / USGS', launched: 2021,
    desc: ['Kamera wielospektralna 30m', 'Multispectral camera 30m'],
    mission: ['Kontynuacja programu Landsat', 'Landsat program continuation'],
    tle1: '1 49260U 21088A   26047.20137823  .00000446  00000+0  10900-3 0  9991',
    tle2: '2 49260  98.1984 119.3291 0001301  93.0200 267.1147 14.57124561233380' },
  { name: 'TERRA', label: 'TERRA', color: '#e879f9', swath: 2330, operator: 'NASA', launched: 1999,
    desc: ['Flagship NASA EOS', 'NASA EOS Flagship'],
    mission: ['Atmosfera, lÄ…d, ocean, energia sÅ‚oneczna', 'Atmosphere, land, ocean, solar energy'],
    tle1: '1 25994U 99068A   26047.41503767  .00000483  00000+0  10765-3 0  9999',
    tle2: '2 25994  97.9640 101.6576 0001191 220.0031 197.3578 14.60991164391972' },
  { name: 'AQUA', label: 'AQUA', color: '#c084fc', swath: 2330, operator: 'NASA', launched: 2002,
    desc: ['Obieg wody na Ziemi', 'Earth water cycle'],
    mission: ['Chmury, opady, wilgotnoÅ›Ä‡ gleby, lÃ³d morski', 'Clouds, precipitation, soil moisture, sea ice'],
    tle1: '1 27424U 02022A   26047.54196259  .00001140  00000+0  23763-3 0  9994',
    tle2: '2 27424  98.4136  14.5283 0001237  48.0988  44.9915 14.61923372265648' },
  { name: 'SUOMI NPP', label: 'NPP', color: '#fb923c', swath: 3060, operator: 'NASA / NOAA', launched: 2011,
    desc: ['Pogoda nowej generacji', 'Next-gen weather'],
    mission: ['Prognoza pogody, zdjÄ™cia nocne Ziemi', 'Weather forecasting, Earth at night imagery'],
    tle1: '1 37849U 11061A   26047.45678056  .00000096  00000+0  66530-4 0  9998',
    tle2: '2 37849  98.7845 349.2315 0001191   2.0852 358.0329 14.19537237741318' },
  { name: 'NOAA 20 (JPSS-1)', label: 'N20', color: '#fdba74', swath: 3060, operator: 'NOAA', launched: 2017,
    desc: ['Pogoda nowej generacji', 'Next-gen weather'],
    mission: ['Prognoza pogody, klimat', 'Weather forecasting, climate'],
    tle1: '1 43013U 17073A   26047.40085247  .00000062  00000+0  50549-4 0  9992',
    tle2: '2 43013  98.7668 348.0030 0000168 149.1100 211.0086 14.19530238427339' },
  { name: 'METOP-B', label: 'METB', color: '#86efac', swath: 2900, operator: 'EUMETSAT', launched: 2012,
    desc: ['Europejska pogoda polarna', 'European polar weather'],
    mission: ['Temperatura, wilgotnoÅ›Ä‡, wiatr', 'Temperature, humidity, wind'],
    tle1: '1 38771U 12049A   26047.46852831  .00000126  00000+0  77650-4 0  9995',
    tle2: '2 38771  98.6689 101.2814 0001917   1.8404 358.2780 14.21437337696117' },
  { name: 'METOP-C', label: 'METC', color: '#4ade80', swath: 2900, operator: 'EUMETSAT', launched: 2018,
    desc: ['Europejska pogoda polarna', 'European polar weather'],
    mission: ['Temperatura, wilgotnoÅ›Ä‡, wiatr', 'Temperature, humidity, wind'],
    tle1: '1 43689U 18087A   26047.35294858  .00000128  00000+0  78477-4 0  9994',
    tle2: '2 43689  98.6814 109.0827 0001972 129.2253 230.9100 14.21513297377667' },
  { name: 'CRYOSAT 2', label: 'CRYO', color: '#67e8f9', swath: 1650, operator: 'ESA', launched: 2010,
    desc: ['Monitoring lodu', 'Ice monitoring'],
    mission: ['GruboÅ›Ä‡ lodu morskiego i lÄ…dolodÃ³w', 'Sea ice and ice sheet thickness'],
    tle1: '1 36508U 10013A   26047.47147451  .00000283  00000+0  69522-4 0  9999',
    tle2: '2 36508  92.0221 248.0651 0002339  81.7770 278.3702 14.51908526840566' },
  { name: 'WORLDVIEW-3', label: 'WV3', color: '#fca5a5', swath: 13, operator: 'Maxar', launched: 2014,
    desc: ['ZdjÄ™cia 31cm (komercyjny)', '31cm imagery (commercial)'],
    mission: ['ZdjÄ™cia bardzo wysokiej rozdzielczoÅ›ci', 'Very high resolution imagery'],
    tle1: '1 40115U 14048A   26047.40000000  .00000500  00000+0  12000-3 0  9999',
    tle2: '2 40115  97.9000 120.0000 0001000  90.0000 270.0000 14.57000000500000' },
  { name: 'NOAA 15', label: 'N15', color: '#fbbf24', swath: 2900, operator: 'NOAA', launched: 1998,
    desc: ['Satelita pogodowy', 'Weather satellite'],
    mission: ['Prognoza pogody', 'Weather forecasting'],
    tle1: '1 25338U 98030A   26047.45483777  .00000156  00000+0  81650-4 0  9990',
    tle2: '2 25338  98.5180  71.2895 0009891 347.8857  12.2085 14.27103684444078' },
  { name: 'NOAA 18', label: 'N18', color: '#f59e0b', swath: 2900, operator: 'NOAA', launched: 2005,
    desc: ['Satelita pogodowy', 'Weather satellite'],
    mission: ['Prognoza pogody', 'Weather forecasting'],
    tle1: '1 28654U 05018A   26047.45071273  .00000060  00000+0  54777-4 0  9996',
    tle2: '2 28654  98.8194 128.8516 0015132 131.8075 228.4392 14.13706355 69251' },
  { name: 'NOAA 19', label: 'N19', color: '#d97706', swath: 2900, operator: 'NOAA', launched: 2009,
    desc: ['Satelita pogodowy', 'Weather satellite'],
    mission: ['Prognoza pogody', 'Weather forecasting'],
    tle1: '1 33591U 09005A   26047.42817595  .00000060  00000+0  55957-4 0  9995',
    tle2: '2 33591  98.9653 118.1588 0013862  16.4560 343.7059 14.13452590877420' },
  { name: 'HST', label: 'HST', color: '#fcd34d', swath: 10, operator: 'NASA / ESA', launched: 1990,
    desc: ['Teleskop Kosmiczny Hubble', 'Hubble Space Telescope'],
    mission: ['Obserwacja gÅ‚Ä™bokiego kosmosu', 'Deep space observation'],
    tle1: '1 20580U 90037B   26047.73401218  .00007734  00000+0  25785-3 0  9999',
    tle2: '2 20580  28.4676 182.9159 0001171 231.8150 128.2340 15.29136516770109' },
  { name: 'CSS (MENGTIAN)', label: 'CSS', color: '#f87171', swath: 400, operator: 'CNSA', launched: 2022,
    desc: ['ChiÅ„ska Stacja Kosmiczna (Tiangong)', 'Chinese Space Station (Tiangong)'],
    mission: ['ZaÅ‚ogowa stacja badawcza', 'Crewed research station'],
    tle1: '1 54216U 22143A   26047.46371112  .00029005  00000+0  35509-3 0  9994',
    tle2: '2 54216  41.4685 337.2223 0004139 115.2170 244.9098 15.59725445158641' },
  { name: 'PACE', label: 'PACE', color: '#06b6d4', swath: 2663, operator: 'NASA', launched: 2024,
    desc: ['Kolor oceanu i aerozole', 'Ocean color and aerosols'],
    mission: ['Monitoring oceanÃ³w i atmosfery', 'Ocean and atmosphere monitoring'],
    tle1: '1 58928U 24025A   26047.82359445  .00000559  00000+0  11198-3 0  9995',
    tle2: '2 58928  98.0889 340.9780 0000790 300.1199  59.9926 14.65445303108303' },
  { name: 'ICESAT-2', label: 'ICE2', color: '#14b8a6', swath: 13, operator: 'NASA', launched: 2018,
    desc: ['Laser mierzÄ…cy lÃ³d', 'Ice-measuring laser altimeter'],
    mission: ['GruboÅ›Ä‡ lodu, lasy, topografia', 'Ice thickness, forests, topography'],
    tle1: '1 43613U 18070A   26047.80463006  .00003091  00000+0  11226-3 0  9996',
    tle2: '2 43613  91.9996 258.5482 0001050 148.8875 211.2437 15.28253508414078' },
  { name: 'OCO 2', label: 'OCO2', color: '#f43f5e', swath: 10, operator: 'NASA', launched: 2014,
    desc: ['Monitoring COâ‚‚', 'COâ‚‚ monitoring'],
    mission: ['Pomiar dwutlenku wÄ™gla w atmosferze', 'Atmospheric carbon dioxide measurement'],
    tle1: '1 40059U 14035A   26047.77766455  .00000535  00000+0  12868-3 0  9997',
    tle2: '2 40059  98.2289 350.8960 0001365  68.9718 291.1626 14.57152151618513' },
  { name: 'AURA', label: 'AURA', color: '#8b5cf6', swath: 2600, operator: 'NASA', launched: 2004,
    desc: ['Monitoring atmosfery', 'Atmosphere monitoring'],
    mission: ['Ozon, jakoÅ›Ä‡ powietrza, klimat', 'Ozone, air quality, climate'],
    tle1: '1 28376U 04026A   26047.87875336  .00001189  00000+0  25178-3 0  9998',
    tle2: '2 28376  98.3276   3.4527 0001153  68.0897 292.0426 14.61097394148644' },
  { name: 'SMAP', label: 'SMAP', color: '#10b981', swath: 1000, operator: 'NASA', launched: 2015,
    desc: ['WilgotnoÅ›Ä‡ gleby', 'Soil moisture'],
    mission: ['Monitoring wilgotnoÅ›ci gleby i cykli zamarzania', 'Soil moisture and freeze-thaw monitoring'],
    tle1: '1 40376U 15003A   26047.80575681  .00000527  00000+0  11119-3 0  9997',
    tle2: '2 40376  98.1307  56.5881 0000868 101.2874 258.8426 14.63310351590015' },
  { name: 'EARTHCARE', label: 'EC', color: '#818cf8', swath: 150, operator: 'ESA / JAXA', launched: 2024,
    desc: ['Chmury i promieniowanie', 'Clouds and radiation'],
    mission: ['Bilans energetyczny Ziemi', 'Earth energy balance'],
    tle1: '1 59908U 24101A   26047.80914811  .00015176  00000+0  21062-3 0  9993',
    tle2: '2 59908  97.0347 175.8818 0001857  93.5919 266.5550 15.57119869 97836' },
  { name: 'JASON-3', label: 'J3', color: '#2dd4bf', swath: 300, operator: 'NASA / NOAA / EUMETSAT', launched: 2016,
    desc: ['Altimetria morska', 'Ocean altimetry'],
    mission: ['Poziom morza, prÄ…dy oceaniczne', 'Sea level, ocean currents'],
    tle1: '1 41240U 16002A   26047.84729800 -.00000059  00000+0  12859-4 0  9990',
    tle2: '2 41240  66.0434  18.8373 0007955 276.0416  83.9697 12.87627528471752' },
  { name: 'SWARM A', label: 'SWA', color: '#d946ef', swath: 300, operator: 'ESA', launched: 2013,
    desc: ['Pole magnetyczne Ziemi', 'Earth magnetic field'],
    mission: ['Pomiar pola magnetycznego', 'Magnetic field measurement'],
    tle1: '1 39452U 13067B   26047.78440870  .00010940  00000+0  20687-3 0  9996',
    tle2: '2 39452  87.3320 100.9009 0002948  93.4115 266.7482 15.48249764687605' },
  { name: 'SWARM B', label: 'SWB', color: '#c026d3', swath: 300, operator: 'ESA', launched: 2013,
    desc: ['Pole magnetyczne Ziemi', 'Earth magnetic field'],
    mission: ['Pomiar pola magnetycznego', 'Magnetic field measurement'],
    tle1: '1 39451U 13067A   26047.90511545  .00005075  00000+0  18668-3 0  9996',
    tle2: '2 39451  87.7456  18.7854 0003416  97.7131 262.4506 15.27642195664874' },
];

const MIN_PASS_RADIUS = 500;

// â”€â”€ STATE â”€â”€
let sats = [];
let userLat = 52.23, userLon = 21.01;
let userLocated = false;
let map, userMarker, satMarkers = {}, satSwaths = {};
let passes = [];
let tleSource = isPl ? 'wbudowane' : 'built-in';
const LANG = isPl ? 0 : 1;

// â”€â”€ INIT â”€â”€
async function init() {
  // Apply language to static HTML
  document.title = T.pageTitle;
  document.querySelector('#loading p').textContent = T.loading;
  document.querySelector('h1').textContent = T.title;
  document.getElementById('alert-bar').textContent = T.alertSearching;
  document.querySelector('.countdown-label').textContent = T.nextPassLabel;
  document.querySelector('.passes-title').textContent = T.upcomingPasses;

  initMap();
  getUserLocation();
  await loadTLEs();
  calculatePasses();
  document.getElementById('loading').classList.add('hidden');
  document.getElementById('status-text').textContent =
    `${sats.length} ${T.sats} Â· ${T.updateEvery} Â· ${T.source}: ${tleSource}`;
  updateLoop();
}

function initMap() {
  map = L.map('map', {
    center: [20, 0],
    zoom: 2,
    zoomControl: false,
    attributionControl: false,
  });
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    maxZoom: 18,
  }).addTo(map);
  L.control.zoom({ position: 'topright' }).addTo(map);

}

function getUserLocation() {
  if (!navigator.geolocation) { placeUserDefault(); return; }
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      userLat = pos.coords.latitude;
      userLon = pos.coords.longitude;
      userLocated = true;
      placeUser();
      map.setView([userLat, userLon], 4);
      if (sats.length) calculatePasses();
    },
    () => placeUserDefault(),
    { timeout: 8000 }
  );
  setTimeout(() => { if (!userLocated) placeUserDefault(); }, 3000);
}

function placeUser() {
  if (userMarker) map.removeLayer(userMarker);
  userMarker = L.marker([userLat, userLon], {
    icon: L.divIcon({
      className: 'sat-icon',
      html: `<div class="sat-marker user-marker"><div class="ring"></div><div class="core"></div><div class="sat-label">${T.you}</div></div>`,
      iconSize: [28, 28], iconAnchor: [14, 14],
    })
  }).addTo(map);
}

function placeUserDefault() {
  if (userMarker) return;
  placeUser();
  map.setView([userLat, userLon], 4);
}

// â”€â”€ TLE LOADING â”€â”€
function parseTleText(text) {
  // Parse 3-line TLE format: name\nline1\nline2
  const lines = text.trim().split('\n').map(l => l.trim()).filter(Boolean);
  const result = [];
  for (let i = 0; i < lines.length - 2; i++) {
    if (lines[i + 1].startsWith('1 ') && lines[i + 2].startsWith('2 ')) {
      result.push({ name: lines[i], line1: lines[i + 1], line2: lines[i + 2] });
      i += 2;
    }
  }
  return result;
}

async function loadTLEs() {
  // Try to fetch fresh TLEs from CelesTrak
  let freshMap = new Map();
  try {
    const urls = [
      'https://celestrak.org/NORAD/elements/gp.php?NAME=SENTINEL&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=25544&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?NAME=LANDSAT&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?NAME=METOP&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?NAME=SWARM&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=20580&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=54216&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=58928&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=43613&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=40059&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=28376&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=40376&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=59908&FORMAT=tle',
      'https://celestrak.org/NORAD/elements/gp.php?CATNR=41240&FORMAT=tle',
    ];
    const results = await Promise.allSettled(
      urls.map(u => fetch(u, { signal: AbortSignal.timeout(5000) }).then(r => r.ok ? r.text() : ''))
    );
    let fresh = [];
    for (const r of results) {
      if (r.status === 'fulfilled' && r.value) fresh.push(...parseTleText(r.value));
    }
    if (fresh.length > 5) {
      freshMap = new Map(fresh.map(t => [t.name, t]));
      tleSource = 'CelesTrak (live)';
    }
  } catch (e) { /* CORS or network â€” use hardcoded */ }

  // Create satellite records from single SATELLITES array
  for (const sat of SATELLITES) {
    try {
      const f = freshMap.get(sat.name);
      const satrec = satellite.twoline2satrec(f ? f.line1 : sat.tle1, f ? f.line2 : sat.tle2);
      if (!satrec || satrec.error) continue;
      sats.push({ ...sat, satrec });
    } catch (e) { /* skip bad TLE */ }
  }

  console.log('Loaded (' + tleSource + '):', sats.map(s => s.name));

  // Create map markers
  for (const s of sats) {
    const desc = s.desc?.[LANG] || '';
    const mission = s.mission?.[LANG] || '';
    const marker = L.marker([0, 0], {
      icon: L.divIcon({
        className: 'sat-icon',
        html: `<div class="sat-marker"><div class="ring" style="border-color:${s.color}"></div><div class="core" style="background:${s.color};box-shadow:0 0 10px ${s.color}"></div><div class="sat-label">${s.label}</div></div>`,
        iconSize: [28, 28], iconAnchor: [14, 14],
      })
    }).addTo(map);
    marker.on('click', () => {
      const pos = getSatPosition(s.satrec, new Date());
      const dist = pos ? Math.round(haversine(userLat, userLon, pos.lat, pos.lon)) : 'â€”';
      const alt = pos ? Math.round(pos.alt) : 'â€”';
      marker.bindPopup(`<div class="sat-popup">
        <div class="sat-popup-name" style="color:${s.color}">${s.name}</div>
        <div class="sat-popup-desc">${desc}</div>
        <div class="sat-popup-row"><span>${T.operator}</span><span>${s.operator || 'â€”'}</span></div>
        <div class="sat-popup-row"><span>${T.mission}</span><span>${mission}</span></div>
        <div class="sat-popup-row"><span>${T.launched}</span><span>${s.launched || 'â€”'}</span></div>
        <div class="sat-popup-row"><span>${T.swathWidth}</span><span>${s.swath} km</span></div>
        <div class="sat-popup-row"><span>${T.altitude}</span><span>${alt} km</span></div>
        <div class="sat-popup-row"><span>${T.distFromYou}</span><span>${dist} km</span></div>
      </div>`, { maxWidth: 260 }).openPopup();
    });
    satMarkers[s.name] = marker;

    const displayRadius = Math.min(s.swath, 1500) * 500;
    const circle = L.circle([0, 0], {
      radius: displayRadius,
      color: s.color,
      fillColor: s.color,
      fillOpacity: 0.05,
      weight: 1,
      opacity: 0.15,
    }).addTo(map);
    satSwaths[s.name] = circle;
  }
}

// â”€â”€ SATELLITE POSITION â”€â”€
function getSatPosition(satrec, date) {
  try {
    const posVel = satellite.propagate(satrec, date);
    if (!posVel.position) return null;
    const gmst = satellite.gstime(date);
    const geo = satellite.eciToGeodetic(posVel.position, gmst);
    return {
      lat: satellite.degreesLat(geo.latitude),
      lon: satellite.degreesLong(geo.longitude),
      alt: geo.height,
    };
  } catch (e) { return null; }
}

// â”€â”€ DISTANCE â”€â”€
function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat / 2) ** 2 +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) ** 2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

// â”€â”€ PASS PREDICTION â”€â”€
function calculatePasses() {
  passes = [];
  const now = new Date();
  const step = 20 * 1000; // 20 seconds
  const horizon = 24 * 60 * 60 * 1000;

  for (const s of sats) {
    let inPass = false;
    let passStart = null;
    let minDist = Infinity;
    const threshold = Math.max(s.swath / 2, MIN_PASS_RADIUS);

    for (let t = 0; t < horizon; t += step) {
      const date = new Date(now.getTime() + t);
      const pos = getSatPosition(s.satrec, date);
      if (!pos) continue;

      const dist = haversine(userLat, userLon, pos.lat, pos.lon);

      if (dist < threshold) {
        if (!inPass) { inPass = true; passStart = date; minDist = dist; }
        if (dist < minDist) minDist = dist;
      } else if (inPass) {
        passes.push({ name: s.name, color: s.color, label: s.label, time: passStart, dist: Math.round(minDist) });
        inPass = false;
        minDist = Infinity;
      }
    }
  }

  passes.sort((a, b) => a.time - b.time);
  renderPasses();
}

function renderPasses() {
  const list = document.getElementById('passes-list');
  if (passes.length === 0) {
    list.innerHTML = `<div style="color:var(--muted);font-size:0.8rem;padding:8px">${T.calculatingPasses}</div>`;
    return;
  }

  const loc = isPl ? 'pl-PL' : 'en-GB';
  list.innerHTML = passes.slice(0, 12).map(p => {
    const timeStr = p.time.toLocaleTimeString(loc, { hour: '2-digit', minute: '2-digit' });
    const dateStr = p.time.toLocaleDateString(loc, { day: 'numeric', month: 'short' });
    return `<div class="pass-item">
      <div class="pass-dot" style="background:${p.color}"></div>
      <div class="pass-name">${p.name}</div>
      <div class="pass-time">${dateStr} ${timeStr}</div>
      <div class="pass-dist">${p.dist} km</div>
    </div>`;
  }).join('');
}

// â”€â”€ UPDATE LOOP â”€â”€
function updateLoop() {
  setInterval(() => {
    const now = new Date();
    let anyOverhead = false;
    let overheadName = '';
    let overheadDist = Infinity;

    for (const s of sats) {
      const pos = getSatPosition(s.satrec, now);
      if (!pos) continue;

      satMarkers[s.name].setLatLng([pos.lat, pos.lon]);
      satSwaths[s.name].setLatLng([pos.lat, pos.lon]);

      const dist = haversine(userLat, userLon, pos.lat, pos.lon);
      const threshold = Math.max(s.swath / 2, MIN_PASS_RADIUS);
      if (dist < threshold && dist < overheadDist) {
        anyOverhead = true;
        overheadName = s.name;
        overheadDist = dist;
      }
    }

    const alertBar = document.getElementById('alert-bar');
    if (anyOverhead) {
      alertBar.classList.add('danger');
      alertBar.innerHTML = `${overheadName} ${T.watchingNow}<div class="alert-sub">${T.distance}: ${Math.round(overheadDist)} km</div>`;
    } else {
      alertBar.classList.remove('danger');
      alertBar.innerHTML = `${T.noOneWatching}<div class="alert-sub">${T.unlessAliens}</div>`;
    }

    updateCountdown(now);
  }, 1000);
}

function updateCountdown(now) {
  const nextPass = passes.find(p => p.time > now);
  if (!nextPass) {
    document.getElementById('next-sat').textContent = T.calculating;
    document.getElementById('next-time').textContent = '--:--:--';
    document.getElementById('next-dist').textContent = '';
    return;
  }

  const diff = nextPass.time - now;
  const h = Math.floor(diff / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);

  document.getElementById('next-sat').textContent = nextPass.name;
  document.getElementById('next-sat').style.color = nextPass.color;
  document.getElementById('next-time').textContent =
    (h > 0 ? h + 'h ' : '') + String(m).padStart(2, '0') + 'min ' + String(s).padStart(2, '0') + 's';
  document.getElementById('next-dist').textContent = `${T.distance}: ~${nextPass.dist} km`;
}

// â”€â”€ UFO EASTER EGG â”€â”€

let ufoMarker = null;
let ufoSwath = null;
let ufoOrbit = null;

function launchUfo() {
  if (ufoMarker) { map.removeLayer(ufoMarker); ufoMarker = null; }
  if (ufoSwath) { map.removeLayer(ufoSwath); ufoSwath = null; }

  // Fake orbit centered on user â€” passes nearby like a real satellite
  const incl = Math.max(Math.abs(userLat) + 10, 50 + Math.random() * 30);
  // Start phase so the sine wave crosses user's latitude soon
  const startPhase = Math.asin(Math.min(Math.max(userLat / incl, -1), 1));
  ufoOrbit = {
    incl,
    lonOffset: userLon - 30 + Math.random() * 60,
    startTime: Date.now(),
    startPhase,
    period: 80000 + Math.random() * 40000,
    direction: Math.random() < 0.5 ? 1 : -1,
  };

  ufoMarker = L.marker([0, 0], {
    icon: L.divIcon({
      className: 'sat-icon',
      html: '<div class="ufo-icon">ðŸ›¸</div>',
      iconSize: [28, 28], iconAnchor: [14, 14],
    }),
    zIndexOffset: 1000,
  }).addTo(map);

  ufoSwath = L.circle([0, 0], {
    radius: 400000,
    color: '#a855f7',
    fillColor: '#a855f7',
    fillOpacity: 0.05,
    weight: 1,
    opacity: 0.15,
  }).addTo(map);

  const msg = UFO_MSGS[Math.floor(Math.random() * UFO_MSGS.length)];
  ufoMarker.on('click', () => {
    ufoMarker.bindPopup(`<div class="sat-popup">
      <div class="sat-popup-name" style="color:#a855f7">???</div>
      <div class="sat-popup-desc">${msg}</div>
      <div class="sat-popup-row"><span>${T.operator}</span><span>${T.ufoUnknown}</span></div>
      <div class="sat-popup-row"><span>${T.ufoOriginLabel}</span><span>${T.ufoOriginVal}</span></div>
      <div class="sat-popup-row"><span>${T.ufoSpeed}</span><span>${T.ufoSpeedVal}</span></div>
    </div>`, { maxWidth: 240 }).openPopup();
  });
}

function removeUfo() {
  if (ufoMarker) { map.removeLayer(ufoMarker); ufoMarker = null; }
  if (ufoSwath) { map.removeLayer(ufoSwath); ufoSwath = null; }
  ufoOrbit = null;
}

function ufoAnimLoop() {
  if (ufoOrbit && ufoMarker) {
    const elapsed = (Date.now() - ufoOrbit.startTime) / ufoOrbit.period;
    // Disappear after flying for 8-15 seconds
    if ((Date.now() - ufoOrbit.startTime) > ufoOrbit.visibleFor) {
      removeUfo();
    } else {
      const angle = ufoOrbit.startPhase + elapsed * 2 * Math.PI * ufoOrbit.direction;
      const lat = ufoOrbit.incl * Math.sin(angle);
      const lon = ((ufoOrbit.lonOffset + elapsed * 120) % 360 + 540) % 360 - 180;
      ufoMarker.setLatLng([lat, lon]);
      ufoSwath.setLatLng([lat, lon]);
    }
  }
  requestAnimationFrame(ufoAnimLoop);
}

function scheduleUfo() {
  requestAnimationFrame(ufoAnimLoop);
  // First appearance after 2 seconds
  setTimeout(() => {
    launchUfo();
    ufoOrbit.visibleFor = 8000 + Math.random() * 7000;
  }, 2000);
  // Then reappear every 15-30 seconds
  setInterval(() => {
    if (!ufoOrbit) {
      launchUfo();
      ufoOrbit.visibleFor = 8000 + Math.random() * 7000;
    }
  }, 15000 + Math.random() * 15000);
}

// â”€â”€ START â”€â”€
init();
scheduleUfo();
</script>
</body>
</html>
